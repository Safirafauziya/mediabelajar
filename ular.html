<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Word Snake ‚Äî English Game</title>
<style>
:root {
  --bg: #071033;
  --panel: #0b2545;
  --accent1: #ff6b6b;
  --accent2: #ffa36c;
}

body {
  margin: 0;
  padding: 0;
  background: var(--bg);
  color: white;
  font-family: "Poppins", sans-serif;
  text-align: center;
}

h1 { margin:0; padding:0; font-size:18px; color:var(--accent2); }

.header { padding: 15px; }

.controls {
  display: flex;
  gap: 10px;
  align-items: center;
  justify-content: center;
  margin-bottom:10px;
}

.controls button {
  background: linear-gradient(90deg,var(--accent1),#ff8a8a);
  border: none;
  color: white;
  padding: 8px 12px;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);
}

button.secondary {
  background: transparent;
  border: 1px solid rgba(255,255,255,0.08);
  padding: 6px 10px;
}

.badge {
  background: rgba(255,255,255,0.05);
  padding: 6px 10px;
  border-radius: 8px;
  font-weight: 700;
  color: var(--accent2);
}

main {
  display: flex;
  gap: 12px;
  justify-content: center;
  flex-wrap: wrap;
  padding: 10px;
}

/* Game area */
.game-wrap {
  flex: 1;
  min-width: 200px;
  max-width: 500px; /* batasi ukuran laptop */
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius: 14px;
  padding: 10px;
  display: flex;
  flex-direction: column;
}

.viewport {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

canvas {
  background: linear-gradient(180deg,#071a2d,#09243a);
  border-radius: 10px;
  display: block;
  max-width: 100%;
  height: auto;
}

.hud {
  display: flex;
  gap: 12px;
  align-items: center;
  margin-top: 8px;
  justify-content: space-between;
}

/* Side panel */
.side {
  width: 300px;
  max-width: 40%;
  min-width: 220px;
  background: linear-gradient(180deg,var(--panel),#08213b);
  border-radius: 12px;
  padding: 12px;
  color: #cfe8ff;
}

.word-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 8px;
  max-height: 46vh;
  overflow: auto;
}

.word-item {
  background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.015));
  padding: 8px;
  border-radius: 8px;
}

/* Mobile controls */
.mobile-controls {
  display: none; /* default desktop hide */
  position: fixed; /* fixed supaya tidak ngehalangi canvas */
  right: 15px;
  bottom: 15px;
  gap: 4px;
  opacity: 0.8;
  z-index: 100;
}

.mobile-controls .dpad {
  display: grid;
  grid-template-columns: repeat(3,40px);
  gap: 4px;
}

.mobile-controls .dpad button {
  width: 40px;
  height: 40px;
  border-radius: 8px;
  background: linear-gradient(180deg,#0d3b52,#0b2e44);
  border: none;
  color: #fff;
  font-weight: 800;
  font-size: 14px;
}

/* Show mobile controls only for small screens */
@media (max-width: 900px){
  .mobile-controls { display:flex; flex-direction: column; }
}

/* Footer */
.footer {
  font-size: 13px;
  color: #9fb3d6;
  margin-top: 10px;
}

/* Modal */
.modal {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: linear-gradient(rgba(3,6,23,0.5),rgba(3,6,23,0.5));
  z-index: 50;
}

.card {
  background: linear-gradient(180deg,#0f2a47,#153a61);
  padding: 16px;
  border-radius: 12px;
  min-width: 260px;
  color: #fff;
  box-shadow: 0 12px 30px rgba(0,0,0,0.6);
}

.choices {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 10px;
}

.choice-btn {
  background: linear-gradient(90deg,var(--accent2),#ffd88a);
  border: none;
  padding: 10px;
  border-radius: 8px;
  font-weight: 800;
  cursor: pointer;
}

/* Mobile controls */
.mobile-controls {
  display: none;
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  bottom: 14px;
  gap: 8px;
}

.dpad {
  display: grid;
  grid-template-columns: repeat(3,64px);
  gap: 8px;
}

.dpad button {
  width: 64px;
  height: 64px;
  border-radius: 12px;
  background: linear-gradient(180deg,#0d3b52,#0b2e44);
  border: none;
  color: #fff;
  font-weight: 800;
}

@media (max-width:900px){
  main { flex-direction: column; align-items:center; }
  .side { width: 100%; max-width: 500px; }
  .mobile-controls{display:block;}
}

</style>
</head>
<body>
<div class="app">
  <header class="header">
    <h1>Word Snake ‚Äî Learn English While Playing üêç</h1>
    <div class="controls">
      <div class="badge">Score: <span id="score">0</span></div>
      <div class="badge">Length: <span id="length">3</span></div>
      <button id="startBtn">Start</button>
      <button id="pauseBtn" class="secondary">Pause</button>
      <button id="resetBtn" class="secondary">Reset</button>
      <button id="backBtn" class="secondary">Kembali</button>
    </div>
  </header>

  <main>
    <section class="game-wrap">
      <div class="viewport">
        <canvas id="gameCanvas" width="600" height="600"></canvas>
        <div class="mobile-controls">
          <div class="dpad">
            <div></div><button id="upBtn">‚ñ≤</button><div></div>
            <button id="leftBtn">‚óÄ</button><div></div>
            <button id="rightBtn">‚ñ∂</button><div></div>
            <button id="downBtn">‚ñº</button>
          </div>
        </div>
      </div>
      <div class="hud">
        <div class="badge">Next word: <span id="nextWord">‚Äî</span></div>
        <div class="badge">Time: <span id="time">0</span>s</div>
      </div>
    </section>

    <aside class="side">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Active Vocabulary</strong>
        <small>Tap a word to pin</small>
      </div>
      <div class="word-list" id="wordList"></div>
      <div class="footer">
        Rules: Eat the glowing words. After eating, choose the correct meaning to grow. Wrong answer shortens snake. Use arrows or swipe. Responsive & colorful.
      </div>
    </aside>
  </main>
</div>

<!-- Modal for quiz -->
<div class="modal" id="modal">
  <div class="card" id="modalCard">
    <div id="modalTitle" style="font-weight:900;font-size:18px">Choose the right meaning</div>
    <div id="modalWord" style="margin-top:8px;font-size:16px;color:#ffcc66"></div>
    <div class="choices" id="modalChoices"></div>
  </div>
</div>

<script>
// Canvas and resize
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function resizeCanvas(){
  const parent = canvas.parentElement;
  const size = Math.min(parent.clientWidth-20, parent.clientHeight-20, 500); // batas laptop max 500
  canvas.width = size;
  canvas.height = size;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// Game variables
let gridSize = 20;
let cell = Math.floor(canvas.width / gridSize);
let snake = [{x:2,y:2},{x:1,y:2},{x:0,y:2}];
let dir = {x:1,y:0};
let nextDir = {x:1,y:0};
let foods = [];
let score = 0;
let gameInterval = null;
let timerInterval = null;
let speed = 120;
let running = false;
let timeSec = 0;
let pinnedWord = null;

const scoreEl = document.getElementById('score');
const lengthEl = document.getElementById('length');
const nextWordEl = document.getElementById('nextWord');
const timeEl = document.getElementById('time');

// Vocabulary
const vocab = [
  {w:'apple', meanings:['a color','a fruit','a vehicle'], ans:1},
  {w:'run', meanings:['to move fast','to sleep','to eat'], ans:0},
  {w:'book', meanings:['to reserve','a written work','to jump'], ans:1},
  {w:'sleep', meanings:['to rest','to read','to sing'], ans:0},
  {w:'water', meanings:['a liquid','a building','a sound'], ans:0},
  {w:'happy', meanings:['sad','joyful','angry'], ans:1},
  {w:'teacher', meanings:['a student','a person who teaches','a vehicle'], ans:1},
  {w:'market', meanings:['a place to buy/sell','a sport','a type of food'], ans:0},
  {w:'window', meanings:['a hole in the roof','a glass opening','a kind of tree'], ans:1},
  {w:'friend', meanings:['enemy','a helper','someone you like to spend time with'], ans:2}
];

// Render word list
const wordListEl = document.getElementById('wordList');
function renderWordList(){
  wordListEl.innerHTML='';
  vocab.forEach(v=>{
    const el = document.createElement('div');
    el.className='word-item';
    el.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
      <strong>${v.w}</strong>
      <button class='secondary' style='padding:4px 8px'>Pin</button>
    </div>
    <div style='font-size:13px;color:#c6e3ff;margin-top:6px'>${v.meanings.join(' ‚Ä¢ ')}</div>`;
    el.querySelector('button').onclick = ()=>{ pinnedWord=v; nextWordEl.textContent=v.w; };
    wordListEl.appendChild(el);
  });
}
renderWordList();

// Helpers
function randInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
function placeFood(){
  for(let a=0;a<100;a++){
    const x=randInt(0,gridSize-1);
    const y=randInt(0,gridSize-1);
    if(snake.some(s=>s.x===x&&s.y===y)) continue;
    if(foods.some(f=>f.x===x&&f.y===y)) continue;
    const v=vocab[randInt(0,vocab.length-1)];
    foods.push({x,y,w:v.w, meanings:v.meanings, ans:v.ans});
    return;
  }
}

// Draw
function draw(){
  cell = Math.floor(canvas.width/gridSize);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // grid
  for(let i=0;i<gridSize;i++){
    for(let j=0;j<gridSize;j++){
      ctx.fillStyle=(i+j)%2?'#04283a':'#052f46';
      ctx.fillRect(i*cell,j*cell,cell-1,cell-1);
    }
  }
  // foods
  foods.forEach(f=>{
    const fx=f.x*cell+cell*0.1, fy=f.y*cell+cell*0.1, fsz=cell*0.8;
    const grad = ctx.createLinearGradient(fx,fy,fx+fsz,fy+fsz);
    grad.addColorStop(0,'#ffd166'); grad.addColorStop(1,'#ff6b6b');
    ctx.fillStyle=grad; ctx.beginPath();
    ctx.ellipse(fx+fsz/2,fy+fsz/2,fsz/2,fsz/2,0,0,Math.PI*2);
    ctx.fill();
    ctx.fillStyle='#082032';
    ctx.font=`${Math.max(12,cell*0.18)}px sans-serif`;
    ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.fillText(f.w, fx+fsz/2, fy+fsz/2);
  });
  // snake
  for(let i=snake.length-1;i>=0;i--){
    const s=snake[i];
    const sx=s.x*cell, sy=s.y*cell;
    const ratio=1-(i/snake.length);
    const color=i===0?'#6bf178':`rgba(${255*Math.min(1,0.2+ratio)},${150*Math.min(1,ratio)},${200*Math.min(1,1-ratio)},1)`;
    ctx.fillStyle=color;
    ctx.fillRect(sx+2,sy+2,cell-4,cell-4);
    if(i===0){ ctx.fillStyle='#042033'; ctx.font=`bold ${Math.max(12,cell*0.24)}px sans-serif`; ctx.fillText('S', sx+cell/2, sy+cell/2); }
  }
}

// Tick
function tick(){
  dir=nextDir;
  const head={x:snake[0].x+dir.x,y:snake[0].y+dir.y};
  // wrap edges
  if(head.x<0) head.x=gridSize-1;
  if(head.x>=gridSize) head.x=0;
  if(head.y<0) head.y=gridSize-1;
  if(head.y>=gridSize) head.y=0;
  if(snake.some((s,idx)=>idx>0 && s.x===head.x && s.y===head.y)){
    stopGame(); alert('Game Over ‚Äî Score: '+score); return;
  }
  snake.unshift(head);
  const eatenIndex=foods.findIndex(f=>f.x===head.x&&f.y===head.y);
  if(eatenIndex>=0){
    const f=foods[eatenIndex]; foods.splice(eatenIndex,1);
    pauseGame(); showModal(f);
  } else { snake.pop(); }
  draw();
}

// Modal
const modal=document.getElementById('modal');
const modalWord=document.getElementById('modalWord');
const modalChoices=document.getElementById('modalChoices');

function showModal(food){
  modal.style.display='flex';
  modalWord.textContent=food.w;
  modalChoices.innerHTML='';
  const opts=food.meanings.slice();
  const correct=opts[food.ans];
  for(let i=opts.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [opts[i],opts[j]]=[opts[j],opts[i]]; }
  opts.forEach(opt=>{
    const b=document.createElement('button'); b.className='choice-btn'; b.textContent=opt;
    b.onclick=()=>handleChoice(opt,correct);
    modalChoices.appendChild(b);
  });
}

function handleChoice(selected,correct){
  modal.style.display='none';
  if(selected===correct){
    snake.push({...snake[snake.length-1]}); snake.push({...snake[snake.length-1]});
    score+=10;
  } else { if(snake.length>3) snake.pop(); score=Math.max(0,score-5); }
  scoreEl.textContent=score;
  lengthEl.textContent=snake.length;
  placeFood();
  resumeGame();
}

// Controls
window.addEventListener('keydown', e=>{
  if(!running) return;
  if(e.key==='ArrowUp' && dir.y===0) nextDir={x:0,y:-1};
  if(e.key==='ArrowDown' && dir.y===0) nextDir={x:0,y:1};
  if(e.key==='ArrowLeft' && dir.x===0) nextDir={x:-1,y:0};
  if(e.key==='ArrowRight' && dir.x===0) nextDir={x:1,y:0};
});

['upBtn','downBtn','leftBtn','rightBtn'].forEach(id=>{
  const el=document.getElementById(id); if(!el) return;
  el.addEventListener('click', ()=>{
    if(id==='upBtn' && dir.y===0) nextDir={x:0,y:-1};
    if(id==='downBtn' && dir.y===0) nextDir={x:0,y:1};
    if(id==='leftBtn' && dir.x===0) nextDir={x:-1,y:0};
    if(id==='rightBtn' && dir.x===0) nextDir={x:1,y:0};
  });
});

// Swipe
let touchStart=null;
canvas.addEventListener('touchstart', e=>{ const t=e.touches[0]; touchStart={x:t.clientX,y:t.clientY}; });
canvas.addEventListener('touchend', e=>{
  if(!touchStart) return; const t=e.changedTouches[0]; const dx=t.clientX-touchStart.x; const dy=t.clientY-touchStart.y;
  if(Math.abs(dx)>Math.abs(dy)){ if(dx>30 && dir.x===0) nextDir={x:1,y:0}; if(dx<-30 && dir.x===0) nextDir={x:-1,y:0}; }
  else { if(dy>30 && dir.y===0) nextDir={x:0,y:1}; if(dy<-30 && dir.y===0) nextDir={x:0,y:-1}; }
  touchStart=null;
});

// Game loop
function startGame(){
  if(running) return;
  running=true; snake=[{x:2,y:2},{x:1,y:2},{x:0,y:2}]; dir={x:1,y:0}; nextDir={x:1,y:0};
  foods=[]; score=0; timeSec=0; scoreEl.textContent='0'; lengthEl.textContent='3'; nextWordEl.textContent='‚Äî';
  placeFood(); draw();
  gameInterval=setInterval(tick,speed);
  timerInterval=setInterval(()=>{ timeSec++; timeEl.textContent=timeSec; },1000);
}

function pauseGame(){ clearInterval(gameInterval); running=false; }
function resumeGame(){ if(!running) gameInterval=setInterval(tick,speed); running=true; }
function stopGame(){ clearInterval(gameInterval); clearInterval(timerInterval); running=false; }

document.getElementById('startBtn').onclick=startGame;
document.getElementById('pauseBtn').onclick=()=>running?pauseGame():resumeGame();
document.getElementById('resetBtn').onclick=()=>{ stopGame(); startGame(); };
const backBtn = document.getElementById('backBtn');
backBtn.addEventListener('click', ()=> {
  window.history.back(); // kembali ke halaman sebelumnya
});
</script>
</body>
</html>
