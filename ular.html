<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Word Snake ‚Äî English Game</title>
<style>
  :root{
    --bg:#071033;
    --panel:#0b2545;
    --accent1:#ff6b6b;
    --accent2:#ffd166;
    --accent3:#6bf178;
    --glass: rgba(255,255,255,0.06);
  }
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;color: #eef2ff;background:linear-gradient(180deg,var(--bg),#071022);}
  .app{display:flex;flex-direction:column;height:100%;gap:10px;padding:12px;box-sizing:border-box}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  h1{font-size:18px;color:var(--accent2);margin:0}
  .controls{display:flex;gap:10px;align-items:center}
  button{background:linear-gradient(90deg,var(--accent1),#ff8a8a);border:none;color:white;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,0.25)}
  button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.08);padding:6px 10px}
  main{display:flex;flex:1;gap:12px}
  /* left: game area */
  .game-wrap{flex:1;min-width:200px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:14px;padding:10px;display:flex;flex-direction:column}
  .viewport{flex:1;display:flex;align-items:center;justify-content:center;position:relative}
  canvas{background:linear-gradient(180deg,#071a2d,#09243a);border-radius:10px;display:block;max-width:100%;height:auto}
  .hud{display:flex;gap:12px;align-items:center;margin-top:8px;justify-content:space-between}
  .badge{background:var(--glass);padding:8px 10px;border-radius:10px;color:var(--accent2);font-weight:700}
  /* right panel */
  .side{width:320px;max-width:40%;min-width:220px;background:linear-gradient(180deg,var(--panel),#08213b);border-radius:12px;padding:12px;color:#cfe8ff}
  .word-list{display:flex;flex-direction:column;gap:8px;margin-top:8px;max-height:46vh;overflow:auto}
  .word-item{background:linear-gradient(90deg,rgba(255,255,255,0.02),rgba(255,255,255,0.015));padding:8px;border-radius:8px}
  .footer{font-size:13px;color:#9fb3d6;margin-top:10px}
  /* modal */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(rgba(3,6,23,0.5),rgba(3,6,23,0.5));z-index:50}
  .card{background:linear-gradient(180deg,#0f2a47,#153a61);padding:16px;border-radius:12px;min-width:260px;color:#fff;box-shadow:0 12px 30px rgba(0,0,0,0.6)}
  .choices{display:flex;flex-direction:column;gap:8px;margin-top:10px}
  .choice-btn{background:linear-gradient(90deg,var(--accent2),#ffd88a);border:none;padding:10px;border-radius:8px;font-weight:800;cursor:pointer}
  .mobile-controls{display:none;position: absolute;left:50%;transform:translateX(-50%);bottom:14px;gap:8px}
  .dpad{display:grid;grid-template-columns:repeat(3,64px);gap:8px}
  .dpad button{width:64px;height:64px;border-radius:12px;background:linear-gradient(180deg,#0d3b52,#0b2e44);border:none;color:#fff;font-weight:800}
  @media (max-width:900px){
    main{flex-direction:column}
    .side{width:100%}
    .mobile-controls{display:block}
  }
</style>
</head>
<body>
<div class="app">
  <header>
    <h1>Word Snake ‚Äî Learn English While Playing üêç</h1>
    <div class="controls">
      <div class="badge">Score: <span id="score">0</span></div>
      <div class="badge">Length: <span id="length">3</span></div>
      <button id="startBtn">Start</button>
      <button id="pauseBtn" class="secondary">Pause</button>
      <button id="resetBtn" class="secondary">Reset</button>
    </div>
  </header>

  <main>
    <section class="game-wrap">
      <div class="viewport">
        <canvas id="gameCanvas" width="600" height="600"></canvas>
        <div class="mobile-controls">
          <div class="dpad">
            <div></div>
            <button id="upBtn">‚ñ≤</button>
            <div></div>
            <button id="leftBtn">‚óÄ</button>
            <div></div>
            <button id="rightBtn">‚ñ∂</button>
            <div></div>
            <button id="downBtn">‚ñº</button>
          </div>
        </div>
      </div>
      <div class="hud">
        <div class="badge">Next word: <span id="nextWord">‚Äî</span></div>
        <div class="badge">Time: <span id="time">0</span>s</div>
      </div>
    </section>

    <aside class="side">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Active Vocabulary</strong>
        <small class="small">Tap a word to pin</small>
      </div>
      <div class="word-list" id="wordList"></div>

      <div class="footer">
        Rules: Eat the glowing words. After eating, choose the correct meaning to grow. Wrong answer shortens snake. Use arrows or swipe. Responsive & colorful.
      </div>
    </aside>
  </main>
</div>

<!-- modal for choices -->
<div class="modal" id="modal">
  <div class="card" id="modalCard">
    <div id="modalTitle" style="font-weight:900;font-size:18px">Choose the right meaning</div>
    <div id="modalWord" style="margin-top:8px;font-size:16px;color:var(--accent3)"></div>
    <div class="choices" id="modalChoices"></div>
  </div>
</div>

<script>
// Responsive canvas helper
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
function resizeCanvas(){
  const parent = canvas.parentElement;
  const maxW = parent.clientWidth - 20;
  const maxH = parent.clientHeight - 20;
  const size = Math.min(maxW, maxH, 700);
  canvas.style.width = size + 'px';
  canvas.style.height = size + 'px';
  canvas.width = size;
  canvas.height = size;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// Game variables
let gridSize = 20; // cells per row
let cell = Math.floor(canvas.width / gridSize);
let snake = [{x:2,y:2},{x:1,y:2},{x:0,y:2}];
let dir = {x:1,y:0};
let nextDir = {x:1,y:0};
let foods = [];
let score = 0;
let gameInterval = null;
let speed = 120; // ms per tick
let running = false;
let timeSec = 0;
let pinnedWord = null;

const scoreEl = document.getElementById('score');
const lengthEl = document.getElementById('length');
const nextWordEl = document.getElementById('nextWord');
const timeEl = document.getElementById('time');

// Vocabulary pool (word : meanings array where one is correct)
const vocab = [
  {w:'apple', meanings:['a color','a fruit','a vehicle'], ans:1},
  {w:'run', meanings:['to move fast','to sleep','to eat'], ans:0},
  {w:'book', meanings:['to reserve','a written work','to jump'], ans:1},
  {w:'sleep', meanings:['to rest','to read','to sing'], ans:0},
  {w:'water', meanings:['a liquid','a building','a sound'], ans:0},
  {w:'happy', meanings:['sad','joyful','angry'], ans:1},
  {w:'teacher', meanings:['a student','a person who teaches','a vehicle'], ans:1},
  {w:'market', meanings:['a place to buy/sell','a sport','a type of food'], ans:0},
  {w:'window', meanings:['a hole in the roof','a glass opening','a kind of tree'], ans:1},
  {w:'friend', meanings:['enemy','a helper','someone you like to spend time with'], ans:2}
];

// UI: populate right panel
const wordListEl = document.getElementById('wordList');
function renderWordList(){
  wordListEl.innerHTML='';
  vocab.forEach((v,i)=>{
    const el = document.createElement('div');
    el.className='word-item';
    el.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><strong>${v.w}</strong><button class='secondary' style='background:transparent;border:1px solid rgba(255,255,255,0.06);color:#cfe8ff;padding:4px 8px;border-radius:8px'>Pin</button></div><div style='font-size:13px;color:#c6e3ff;margin-top:6px'>${v.meanings.join(' ‚Ä¢ ')}</div>`;
    el.querySelector('button').onclick = ()=>{ pinnedWord = v; nextWordEl.textContent = v.w; }; 
    wordListEl.appendChild(el);
  });
}
renderWordList();

// Helpers
function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function placeFood(){
  // place a food at random empty cell with a random vocab
  const attempts = 100;
  for(let a=0;a<attempts;a++){
    const x = randInt(0,gridSize-1);
    const y = randInt(0,gridSize-1);
    if(snake.some(s=>s.x===x && s.y===y)) continue;
    if(foods.some(f=>f.x===x && f.y===y)) continue;
    const v = vocab[randInt(0,vocab.length-1)];
    foods.push({x,y,w:v.w, meanings:v.meanings, ans:v.ans});
    return;
  }
}

// draw
function draw(){
  cell = Math.floor(canvas.width / gridSize);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // background grid
  for(let i=0;i<gridSize;i++){
    for(let j=0;j<gridSize;j++){
      const gx = i*cell, gy = j*cell;
      ctx.fillStyle = (i+j)%2? '#04283a':'#052f46';
      ctx.fillRect(gx,gy,cell-1,cell-1);
    }
  }
  // foods
  foods.forEach(f=>{
    const fx = f.x*cell + cell*0.1, fy = f.y*cell + cell*0.1, fsz = cell*0.8;
    // colorful circle
    const grad = ctx.createLinearGradient(fx,fy,fx+fsz,fy+fsz);
    grad.addColorStop(0,'#ffd166'); grad.addColorStop(1,'#ff6b6b');
    ctx.fillStyle = grad; ctx.beginPath(); ctx.ellipse(fx+fsz/2,fy+fsz/2,fsz/2,fsz/2,0,0,Math.PI*2); ctx.fill();
    // word
    ctx.fillStyle = '#082032'; ctx.font = `${Math.max(12,cell*0.18)}px sans-serif`; ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.fillText(f.w, fx+fsz/2, fy+fsz/2);
  });
  // snake
  for(let i=snake.length-1;i>=0;i--){
    const s = snake[i];
    const sx = s.x*cell, sy = s.y*cell;
    const ratio = 1 - (i / Math.max(1,snake.length));
    const color = i===0 ? '#6bf178' : `rgba(${255*Math.min(1,0.2+ratio)},${150*Math.min(1,ratio)},${200*Math.min(1,1-ratio)},1)`;
    ctx.fillStyle = color;
    ctx.fillRect(sx+2,sy+2,cell-4,cell-4);
    if(i===0){ ctx.fillStyle='#042033'; ctx.font=`bold ${Math.max(12,cell*0.24)}px sans-serif`; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText('S', sx+cell/2, sy+cell/2); }
  }
}

function tick(){
  // update direction
  dir = nextDir;
  const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};
  // wrap-around edges
  if(head.x < 0) head.x = gridSize-1;
  if(head.x >= gridSize) head.x = 0;
  if(head.y < 0) head.y = gridSize-1;
  if(head.y >= gridSize) head.y = 0;
  // collision with self -> game over
  if(snake.some((s,idx)=>idx>0 && s.x===head.x && s.y===head.y)){
    stopGame(); alert('Game Over ‚Äî you collided with yourself. Score: '+score); return;
  }
  snake.unshift(head);
  // check food
  const eatenIndex = foods.findIndex(f=>f.x===head.x && f.y===head.y);
  if(eatenIndex >= 0){
    const f = foods[eatenIndex];
    foods.splice(eatenIndex,1);
    // pause and show quiz modal
    pauseGame();
    showModal(f);
  } else {
    snake.pop();
  }
  draw();
}

// modal logic
const modal = document.getElementById('modal');
const modalWord = document.getElementById('modalWord');
const modalChoices = document.getElementById('modalChoices');
function showModal(food){
  modal.style.display='flex';
  modalWord.textContent = food.w;
  modalChoices.innerHTML='';
  // randomize choices including correct one
  const opts = food.meanings.slice();
  // ensure correct exists at ans
  const correct = opts[food.ans];
  // shuffle
  for(let i=opts.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [opts[i],opts[j]]=[opts[j],opts[i]]; }
  opts.forEach(opt=>{
    const b = document.createElement('button'); b.className='choice-btn'; b.textContent = opt; b.onclick = ()=>{ handleChoice(opt, correct); };
    modalChoices.appendChild(b);
  });
}

function handleChoice(selected, correct){
  modal.style.display='none';
  if(selected === correct){
    // reward: grow by 2 and +points
    snake.push({...snake[snake.length-1]});
    snake.push({...snake[snake.length-1]});
    score += 10;
    document.getElementById('score').textContent = score;
    document.getElementById('length').textContent = snake.length;
    // place a new food
    placeFood();
    resumeGame();
  } else {
    // penalty: shrink by 1 (but min 3)
    if(snake.length > 3) snake.pop();
    score = Math.max(0, score - 5);
    document.getElementById('score').textContent = score;
    document.getElementById('length').textContent = snake.length;
    placeFood();
    resumeGame();
  }
}

// controls: arrows, swipe, on-screen buttons
window.addEventListener('keydown', e=>{
  if(!running) return;
  if(e.key === 'ArrowUp' && dir.y === 0){ nextDir = {x:0,y:-1}; }
  if(e.key === 'ArrowDown' && dir.y === 0){ nextDir = {x:0,y:1}; }
  if(e.key === 'ArrowLeft' && dir.x === 0){ nextDir = {x:-1,y:0}; }
  if(e.key === 'ArrowRight' && dir.x === 0){ nextDir = {x:1,y:0}; }
});
// mobile buttons
['upBtn','downBtn','leftBtn','rightBtn'].forEach(id=>{
  const el = document.getElementById(id);
  if(!el) return;
  el.addEventListener('click', ()=>{
    if(id==='upBtn' && dir.y===0) nextDir={x:0,y:-1};
    if(id==='downBtn' && dir.y===0) nextDir={x:0,y:1};
    if(id==='leftBtn' && dir.x===0) nextDir={x:-1,y:0};
    if(id==='rightBtn' && dir.x===0) nextDir={x:1,y:0};
  });
});

// swipe detection
let touchStart = null;
canvas.addEventListener('touchstart', e=>{ const t=e.touches[0]; touchStart={x:t.clientX,y:t.clientY}; });
canvas.addEventListener('touchend', e=>{ if(!touchStart) return; const t=e.changedTouches[0]; const dx=t.clientX-touchStart.x; const dy=t.clientY-touchStart.y; if(Math.abs(dx) > Math.abs(dy)){ if(dx>30 && dir.x===0) nextDir={x:1,y:0}; if(dx<-30 && dir.x===0) nextDir={x:-1,y:0}; } else { if(dy>30 && dir.y===0) nextDir={x:0,y:1}; if(dy<-30 && dir.y===0) nextDir={x:0,y:-1}; } touchStart=null; });

// start / pause / reset
const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const resetBtn = document.getElementById('resetBtn');
startBtn.addEventListener('click', startGame);
pauseBtn.addEventListener('click', ()=>{ if(running) pauseGame(); else resumeGame(); });
resetBtn.addEventListener('click', ()=>{ resetGame(); });

function startGame(){
  if(running) return;
  // initialize
  gridSize = Math.max(12, Math.floor(canvas.width / 30));
  cell = Math.floor(canvas.width / gridSize);
  snake = [{x:2,y:2},{x:1,y:2},{x:0,y:2}]; dir={x:1,y:0}; nextDir={x:1,y:0}; foods=[]; score=0; timeSec=0;
  document.getElementById('score').textContent=0; document.getElementById('length').textContent=snake.length; nextWordEl.textContent='‚Äî';
  // spawn initial foods
  for(let i=0;i<3;i++) placeFood();
  running = true;
  gameInterval = setInterval(()=>{ tick(); }, speed);
  timerInterval = setInterval(()=>{ timeSec++; timeEl.textContent = timeSec; }, 1000);
}
function stopGame(){ running=false; clearInterval(gameInterval); clearInterval(timerInterval); }
function pauseGame(){ running=false; clearInterval(gameInterval); clearInterval(timerInterval); pauseBtn.textContent='Resume'; }
function resumeGame(){ if(running) return; running=true; gameInterval=setInterval(()=>{ tick(); }, speed); timerInterval=setInterval(()=>{ timeSec++; timeEl.textContent=timeSec; },1000); pauseBtn.textContent='Pause'; }
function resetGame(){ stopGame(); snake=[{x:2,y:2},{x:1,y:2},{x:0,y:2}]; dir={x:1,y:0}; nextDir={x:1,y:0}; foods=[]; score=0; timeSec=0; document.getElementById('score').textContent=0; document.getElementById('length').textContent=snake.length; timeEl.textContent=0; placeFood(); draw(); }
let timerInterval;

// initialize one food and draw
placeFood(); draw();

// On load, ensure canvas resized and grid recalculated
window.addEventListener('load', ()=>{ resizeCanvas(); gridSize = Math.max(12, Math.floor(canvas.width / 30)); cell = Math.floor(canvas.width / gridSize); draw(); });

</script>
</body>
</html>
